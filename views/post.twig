{#
/**
 * Post Template
 *
 * @author Travis Cook (cooktw@missouri.edu), Digital Service, University of Missouri
 * @copyright 2022 Curators of the University of Missouri
 *
 * Variables:
 * - content: (string) Main content.
 * - page: (object) Post content (see https://github.com/jarednova/timber/wiki/TimberPost for properties).
 */
#}

{% extends ['site-page.twig', 'page.twig'] %}

{% set include_share_buttons = include_share_buttons|default(option.enable_social_media_sharing_buttons) %}
{% set social_media_sprite_path = theme.parent.link ?? theme.link ~ '/assets/images/miz-sprite.svg' %}

{% block head_js %}
{{ parent() }}
{% if include_share_buttons %}
<div id="fb-root"></div>
<script>
    (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
</script>
{% endif %}
{% endblock %}

{% block pre_content__page_headers %}
{% embed '@miz/components/page-header/page-header.twig' with {
    'title': page.title|striptags('<em>')|raw,
    'class': 'article__header'
} %}
    {% block page_header %}
    <div class="miz-container">
        {% if page.terms('category') %}
        <div class="entry-meta">
            <p class="article__category">{% for category in page.terms('category') %}<a href="{{ category.link|raw }}">{{ category.name}}</a>{% if not loop.last %} | {% endif %}{% endfor %}</p>
        </div>
        {% endif %}

        <h2 class="miz-page-header__title">{{ pageHeaderTitle }}</h2>
        {% if (page.subhead) %}
        <p class="miz-page-header__blurb">{{ page.subhead|raw }}</p>
        {% endif %}
    </div>
    {% endblock %}
{% endembed %}
{% endblock %}

{% block content %}

{% if (page.author_name) %}
    <p class="article__author">By {{ page.author_name|striptags('<em>')|raw }}</p>
{% endif %}
{% if (page.date) %}
    <p class="article__date">Published on {{ page.date|date_ap_style }}</p>
    {% if page.modified_date and (page.modified_date != page.date) %}
    <p class="article__date">Updated on {{ page.modified_date|date_ap_style }}</p>
    {% endif %}
{% endif %}

{% if page.get_field('video_url') and page.get_field('video_title') %}
<figure class="video">
    <iframe src="{{ page.get_field('video_url') }}" title="{{ page.get_field('video_title') }}" frameborder="0" allowfullscreen="allowfullscreen"></iframe>
</figure>
{% endif %}

{{ page.content|raw }}

{% endblock content %}

{% block content_aside %}
{{ parent() }}

{% if (page.attribution) %}
<p class="article__attribution">
    {% if (page.attribution_link) %}
        <a href="{{ page.attribution_link }}">{{ page.attribution|striptags('<em>')|raw }}</a>
    {% else %}
        {{ page.attribution|striptags('<em>')|raw }}
    {% endif %}
</p>
{% endif %}

{% if page.terms('tag') %}
<div class="entry-meta">
    <p class="article__category">{% for tag in page.terms('tag') %}<a href="{{ tag.link|raw }}">{{ tag.name}}</a>{% if not loop.last %} | {% endif %}{% endfor %}</p>
</div>
{% endif %}


{% endblock content_aside %}

{% block post_content__layer_processing %}
{% if include_share_buttons %}
<div class="miz-container">
    <hr class="miz-border--gold miz-border--width-2" />

    <div class="share-to-social-list">
        <a class="miz-button miz-button--small miz-button--share-facebook" href="https://facebook.com/sharer.php?u={{ page.current_page }}" data-size="large" data-layout="button_count" data-href="{{ page.current_page }}"><svg class="miz-icon miz-icon__svg miz-icon--sm miz-svg--white miz-svg--facebook" aria-hidden="true" focusable="false"><use xlink:href="{{ social_media_sprite_path }}#icons--social--facebook"></use></svg> Share</a>
        <a class="miz-button miz-button--small miz-button--share-twitter" href="https://twitter.com/intent/tweet" data-show-count="false" data-size="large"><svg class="miz-icon miz-icon__svg miz-icon--sm miz-svg--white miz-svg--twitter" aria-hidden="true" focusable="false"><use xlink:href="{{ social_media_sprite_path }}#icons--social--twitter"></use></svg> Tweet</a>
    </div>
</div>
{% endif %}
{% endblock post_content__layer_processing %}

{% block foot %}
{% if include_share_buttons %}
<script>
    window.twttr = (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0],
        t = window.twttr || {};
    if (d.getElementById(id)) return t;
    js = d.createElement(s);
    js.id = id;
    js.src = "https://platform.twitter.com/widgets.js";
    fjs.parentNode.insertBefore(js, fjs);

    t._e = [];
    t.ready = function(f) {
        t._e.push(f);
    };

    return t;
    }(document, "script", "twitter-wjs"));
</script>
{% endif %}
{{ parent() }}
{% endblock %}
