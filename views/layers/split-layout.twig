{# Imports #}
{% from "@miz/components/button/button.twig" import AnchorButton as anchorButton %}

{% set LayerSectionClasses = ['miz-layer', 'miz-layer--brand', 'miz-main-grid__full'] %}
{% set LayerContentClasses = ['miz-split-layout__content--frame'] %}
{% set LayerFrameClasses = ['miz-split-layout'] %}

{% if flexgroup.displayOptions.layer_background == 'miz-black-100' %}
	{% set LayerSectionClasses = LayerSectionClasses|merge(['miz-fill--black-100']) %}
{% elseif flexgroup.displayOptions.layer_background == 'miz-black' %}
	{% set LayerSectionClasses = LayerSectionClasses|merge(['miz-fill--black']) %}
{% elseif flexgroup.displayOptions.layer_background == 'miz-white' %}
	{% set LayerSectionClasses = LayerSectionClasses|merge(['miz-fill--white']) %}
{% endif %}

{% if flexgroup.displayOptions.image != '' and flexgroup.displayOptions.layer_background == 'image' %}
	{% set LayerSectionClasses = LayerSectionClasses|merge(['miz-background-gel--dark']) %}
	{% set LayerSectionBackgroundImage = Image(flexgroup.displayOptions.image).src %}
	{% set LayerContentClasses = LayerContentClasses|merge(['miz-fill--transparent']) %}
{% endif %}

{% if (flexgroup.displayOptions.content_background == 'light') and (flexgroup.displayOptions.variant == 'offset') %}
	{% set LayerContentClasses = LayerContentClasses|merge(['miz-fill--black-100', 'miz-text--black']) %}
{% elseif (flexgroup.displayOptions.content_background == 'dark') and (flexgroup.displayOptions.variant == 'offset') %}
	{% set LayerContentClasses = LayerContentClasses|merge(['miz-fill--black']) %}
{% endif %}

{% if "right" == flexgroup.displayOptions.media_align %}
    {% set LayerFrameClasses = LayerFrameClasses|merge(['miz-split-layout--flip']) %}
{% endif %}

{% if 'offset' == flexgroup.displayOptions.variant %}
    {% set LayerFrameClasses = LayerFrameClasses|merge(['miz-split-layout--no-gap']) %}
		{% set LayerContentClasses = LayerContentClasses|merge(['miz-split-layout__header-content']) %}
{% endif %}

{# Defaults #}
{% set splitLayoutLayer = {
	'title': flexgroup.title,
	'kicker': flexgroup.kicker,
	'content': flexgroup.message,
	'buttons': flexgroup.buttons,
	'mediaType': flexgroup.mediaType,
	'image': {
		'file': Image(flexgroup.image),
		'align': flexgroup.displayOptions.media_align
	},
	'video': {
		'title': flexgroup.video.title,
		'src': 'https://www.youtube.com/embed/' ~ flexgroup.video.id
	},
	'variant': flexgroup.displayOptions.variant,
	'classes': {
		'section': LayerSectionClasses|join(' '),
		'frame': LayerFrameClasses|join(' '),
		'figure': flexgroup.mediaType == 'video' ? 'miz-split-layout__figure miz-split-layout__figure--video' : 'miz-split-layout__figure',
		'title': flexgroup.displayOptions.content_background == 'light' ? '' : ' miz-text--gold',
		'kicker': flexgroup.displayOptions.content_background == 'light' ? '' : ' miz-text--white',
		'content': LayerContentClasses|join(' ')
	},
	'style': {
		'section': LayerSectionBackgroundImage ? "background: #000000 url('" ~ LayerSectionBackgroundImage ~ "') top left/cover;" : ''
	}
} %}

<section class="{{ splitLayoutLayer.classes.section }}"{% if splitLayoutLayer.style.section != '' %} style="{{ splitLayoutLayer.style.section }}"{% endif %}>
    <div class="miz-container">
			<div class="{{ splitLayoutLayer.classes.frame }}">
				<div class="{{ splitLayoutLayer.classes.content }}">
					<header class="miz-layer__header miz-split-layout__header">
						{% if splitLayoutLayer.kicker %}
							<h2 class="miz-layer__kicker{% if splitLayoutLayer.classes.kicker != '' %}{{ splitLayoutLayer.classes.kicker }}{% endif %}">{{ splitLayoutLayer.kicker }}</h2>
						{% endif %}
						<h2 class="miz-layer__title{% if splitLayoutLayer.classes.title != '' %}{{ splitLayoutLayer.classes.title }}{% endif %}">{{ splitLayoutLayer.title }}</h2>
					</header>
					<div class="miz-layer__content miz-split-layout__content">
						{{ splitLayoutLayer.content }}

						{% if splitLayoutLayer.buttons is defined and splitLayoutLayer.buttons is iterable %}
							{% for Button in splitLayoutLayer.buttons %}
								{% set buttonOptions = { "class": "miz-button miz-button--primary miz-button--brand", "text": Button.button.title, 'href': Button.button.url } %}
								{{ anchorButton( buttonOptions ) }}
							{% endfor %}
						{% endif %}
					</div>
				</div>
				{% if splitLayoutLayer.image.file or splitLayoutLayer.video.src %}
				<figure class="{{ splitLayoutLayer.classes.figure }}">
					{% if (splitLayoutLayer.mediaType == 'video') %}
						<iframe src="{{ splitLayoutLayer.video.src }}" title="{{ splitLayoutLayer.video.title }}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen class="miz-split-layout__video"></iframe>
					{% else %}
						{% if (splitLayoutLayer.image.file) %}
						<img src="{{ splitLayoutLayer.image.file.src('large') }}" alt="{{ splitLayoutLayer.image.file.alt }}" class="miz-split-layout__image">
						{% endif %}
					{% endif %}
				</figure>
				{% endif %}
			</div>
    </div>
</section>
