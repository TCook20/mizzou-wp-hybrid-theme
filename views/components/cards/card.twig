{#
/**
 * Card Template
 *
 * @author Travis Cook (cooktw@missouri.edu), Digital Service, University of Missouri
 * @copyright 2020 Curators of the University of Missouri
 *
 * Variables:
 * - page: (object) Block content (see https://github.com/jarednova/timber/wiki/TimberPost for properties).
 */
#}

{% from "@miz/components/card/card.twig" import Card as mizCard %}

{% set cardContents = {} %}
{% set CardBodyContent = {} %}

{% set card_classes = card_classes|default(fields.card_class) %}
{% set card_modifier_class = card_modifier_class|default(false) %}
{% set card_orientation = card_orientation|default(fields.card_orientation) %}

{# Apply resize filters #}
{% if (card_image_resize_width) and (card_image_resize_height) %}
    {% set card_image_src = card_image_src|resize(card_image_resize_width, card_image_resize_height) %}
{% elseif (card_image_resize_width) %}
    {% set card_image_src = card_image_src|resize(card_image_resize_width) %}
{% endif %}

{% set card = {
    'id': cardId,
    'theme': cardTheme|default(themeClass),
    'classes': card_modifier_class ~ ' ' ~ card_classes,
    'title': card_title|default(fields.title),
    'content': card_content|default(fields.content),
    'link': card_link|default(fields.link.ur),
    'image': {
        'src': card_image_src|default(Image(fields.image).src),
        'alt': card_image_alt|default(Image(fields.image).alt),
        'height': card_image_resize_height|default(290),
        'width': card_image_resize_width|default(464)
    }
} %}

{% set cardClasses = '' %}

{% if card.theme %}
    {% set cardClasses = cardClasses ~ ' ' ~ card.theme %}
{% endif %}

{% if card.classes %}
    {% set cardClasses = cardClasses ~ ' ' ~ card.classes %}
{% endif %}

{% if card_orientation == 'landscape' %}
    {% set cardClasses = cardClasses ~ ' miz-card--inline' %}
{% endif %}

{% if card.image.src and card.image.alt %}
    {% set cardImage = {
        "type": "image",
        "src": card.image.src,
        "alt": card.image.alt
    } %}
    {% set cardContents = cardContents|merge([cardImage]) %}
{% endif %}

{% set cardTitle = {
  "type": "title",
  "content": card.title
} %}
{% set CardBodyContent = CardBodyContent|merge([cardTitle]) %}

{% if card.content %}
    {% set cardExcerpt = {
        "type": "text",
        "content": card.content
    } %}
    {% set CardBodyContent = CardBodyContent|merge([cardExcerpt]) %}
{% endif %}

{% set cardOptions = {
  "class": cardClasses,
  "contents": cardContents
} %}

{{ mizCard( cardOptions ) }}
