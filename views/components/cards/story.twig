{#
/**
 * Story (News)
 *
 * @author Travis Cook (cooktw@missouri.edu), Digital Service, University of Missouri
 * @copyright 2022 Curators of the University of Missouri
 *
 * Variables:
 * - story_attribution: (string) Attribution for the story; i.e. "From Undergraduate Studies", or "By Josh Murray" (optional).
 * - story_attribution_link: (string) Link for the attribution (optional).
 * - story_category: (string) Category for the story (optional).
 * - story_category_link: (string) Link for the category (optional).
 * - story_date: (string) Publication date (optional).
 * - story_excerpt: (string) Story excerpt.
 * - story_feature: (boolean) Whether or not this is a feature story (optional, see default).
 * - story_feature_hide_text: (boolean) Whether to hide the caption text for feature stories (optional).
 * - story_feature_text_alignment: (string) Alignment for feature story caption. Can be 'top left', 'top right', 'bottom left', or 'bottom right'. Defaults to 'bottom right' (optional).
 * - story_heading_level: (int) Heading level for the title. Can be 1-6 (optional, see default).
 * - story_image_alt: (string) Alt attribute for the story image (only required if image_src is set).
 * - story_image_src: (string) Src attribute for the story image (optional).
 * - story_image_resize_width: (int) Width to resize image to (optional, Timber-only).
 * - story_image_resize_height: (int) Height to resize image to (optional, Timber-only).
 * - story_link: (string) Link for the story.
 * - story_link_external: (string) External link for the story. Takes precedence over story_link (optional).
 * - story_location: (string) Event specific. Location of event (optional).
 * - story_title: (string) Title for the story.
 */
#}
{% from "@miz/components/news-card/news-card.twig" import NewsCard as newsCard %}

{# Set link #}
{% if (story_link_external) and (story_link_external != 'http://') and (story_link_external != 'https://') %}
    {% set story_link = story_link_external %}
{% endif %}

{% set story = {
    'id': story_id,
    'class': story_modifier_class,
    'title': story_title,
    'content': story_excerpt,
    'link': story_link,
    'attribution': {
        'name': story_attribution,
        'link': story_attribution_link
    },
    'category': {
        'name': story_category,
        'link': story_category_link
    },
    'image': {
        'alt': story_image_alt,
        'src': story_image_src,
        'height': story_image_resize_height,
        'width': story_image_resize_width,
    }
} %}

{% set cardContents = {} %}
{% set CardBodyContent = {} %}

{% if story.category.name %}
    {% set cardTopic = {
        "topic": {
            "text": story.category.name,
            "href": story.category.link
        }
    } %}
    {% set cardContents = cardContents|merge([cardTopic]) %}
{% endif %}

{% if story.image.src and story.image.alt %}
    {% set cardImage = {
        "type": "thumb",
        "src": story.image.src,
        "alt": story.image.alt
    } %}
    {% set cardContents = cardContents|merge([cardImage]) %}
{% endif %}

{% set cardTitle = {
  "type": "title",
  "class": "miz-card__title--mark miz-card__title--news"
  "content": Card.title
} %}
{% set CardBodyContent = CardBodyContent|merge([cardTitle]) %}

{% set cardSubtitle = {
  "type": "subtitle",
  "content": Card.slug|upper|replace('-', ' ')
} %}
{% set CardBodyContent = CardBodyContent|merge([cardSubtitle]) %}

{% if story.content %}
    {% set cardExcerpt = {
    "type": "text",
    "content": story.content
    } %}
    {% set CardBodyContent = CardBodyContent|merge([cardExcerpt]) %}
{% endif %}

{% if story.link %}
    {% set cardLink = {
        "link": {
            "href": story.link
        }
    } %}
    {% set cardContents = cardContents|merge([cardLink]) %}
{% endif %}

{% set cardOptions = {
  "class": "miz-news-card miz-card--brand miz-card--auto",
  "contents": cardContents
} %}

{{ newsCard( cardOptions ) }}
